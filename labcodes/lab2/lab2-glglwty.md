#lab2实验报告
2012011282 计22 王天一
##练习1：实现 first-fit 连续物理内存分配算法（需要编程）
###设计实现过程
####default_init_memmap
此函数的目的为将一片连续的内存空间初始化为n个Page项，只需将他们依次加入链表之后初始化ref，property和flags项即可。
####default_alloc_pages
此函数的目的为找到一片连续的页然后分配出来。实现过程为从前往后遍历free_list，找到合适的项之后将他们取出链表，设置reserved位为1，property位为0，更改nr_free后返回。
####default_free_pages
此函数的目的为将一片连续的页释放掉。实现过程为从前往后找到地址比base大的表项，然后把被释放的pages加入链表，并且重置其ref，property和flags位。最后向前向后寻找连续的pages，向property域填入正确的值。
###你的first fit算法是否有进一步的改进空间
可以使用块状链表维护一块链表中的最大连续空间，这样分配过程中寻找合适位置的复杂度降低为sqrt(N)，同时释放页时寻找位置的复杂度也降低为sqrt(N)
##练习2：实现寻找虚拟地址对应的页表项（需要编程）
###设计实现过程
注释给的太详细了。先找到pde，然后检查PTE_P位，如果为0就分配一个页，将这个页清0，然后设置PTE_P，PTE_W, PTE_U位为1并且向pde中填充分配到的页的物理地址即可。
###请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。
页目录项由页表物理地址，PTE_P，PTE_W，PTE_U组成，页表物理地址是4k对齐的，用来寻找二级页表，PTE_P决定二级页表是否存在，PTE_W决定二级页表是否可写，PTE_U决定二级页表是否可以被用户访问。
页表项由页物理地址，PTE_P, PTE_W组成。页物理地址是4K对齐的，其他标识位意义同上。
###如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？
如果没有发生特权转换：在当前栈上压入eflags, cs, eip和errorcode，并查找idt并跳转到中断服务程序。
如果发生了特权转换：创建终端处理栈，压入ss, esp, eflags, cs, eip, errorcode，然后查找idt跳转到终端服务程序。
##练习3：释放某虚地址所在的页并取消对应二级页表项的映射（需要编程）
###设计实现过程
首先由pte找到Page结构体，降低该物理内存的ref，如果ref为0就将此块物理内存释放掉。
###数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是啥？
有。Page的实例存在全局变量pages中，pages[i]代表第i块物理页，而一个页表项也指向一个物理页，这个物理地址会对应一个Page结构。不过多个页表项可以映射到同一个Page结构，这时Page的ref会增加。
###如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ 鼓励通过编程来具体完成这个问题
为alloc_page增加参数，指定分配的物理地址。而维护页表的时候的get_pte函数中调用alloc_page时指定要访问的虚拟地址。这样分配到的物理地址和虚拟地址就一样了。
